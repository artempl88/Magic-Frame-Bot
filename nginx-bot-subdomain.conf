# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx –¥–ª—è Seedance Bot –Ω–∞ –ø–æ–¥–¥–æ–º–µ–Ω–µ bot.seedancebot.com
# –ü–æ–º–µ—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ /etc/nginx/sites-available/bot-seedancebot
# –ò —Å–æ–∑–¥–∞–π—Ç–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É: ln -s /etc/nginx/sites-available/bot-seedancebot /etc/nginx/sites-enabled/

# –†–µ–¥–∏—Ä–µ–∫—Ç HTTP ‚Üí HTTPS –¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–∞
server {
    listen 80;
    server_name bot.seedancebot.com;
    
    # –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
    location / {
        return 301 https://$server_name$request_uri;
    }
}

# –û—Å–Ω–æ–≤–Ω–æ–π HTTPS —Å–µ—Ä–≤–µ—Ä –¥–ª—è –±–æ—Ç–∞
server {
    listen 443 ssl http2;
    server_name bot.seedancebot.com;
    
    # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç Beget
    # –í–∞—Ä–∏–∞–Ω—Ç 1: Wildcard —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç *.seedancebot.com
    ssl_certificate /etc/ssl/certs/seedancebot.com.crt;
    ssl_certificate_key /etc/ssl/private/seedancebot.com.key;
    
    # –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–∞
    # ssl_certificate /etc/ssl/certs/bot.seedancebot.com.crt;
    # ssl_certificate_key /etc/ssl/private/bot.seedancebot.com.key;
    
    # –í–∞—Ä–∏–∞–Ω—Ç 3: Let's Encrypt –æ—Ç Beget
    # ssl_certificate /etc/letsencrypt/live/bot.seedancebot.com/fullchain.pem;
    # ssl_certificate_key /etc/letsencrypt/live/bot.seedancebot.com/privkey.pem;
    
    # –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Content-Security-Policy "default-src 'self'" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # Rate limiting –¥–ª—è webhook
    limit_req_zone $binary_remote_addr zone=bot_webhook:10m rate=10r/s;
    
    # Telegram webhook (–æ—Å–Ω–æ–≤–Ω–æ–π endpoint)
    location /webhook {
        # Rate limiting
        limit_req zone=bot_webhook burst=20 nodelay;
        
        # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –±–æ—Ç–∞
        proxy_pass http://127.0.0.1:8080/webhook;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
        client_max_body_size 20m;
        
        # –¢–∞–π–º–∞—É—Ç—ã
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # –¢–æ–ª—å–∫–æ POST –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Telegram
        limit_except POST {
            deny all;
        }
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ webhook –∑–∞–ø—Ä–æ—Å–æ–≤
        access_log /var/log/nginx/bot_webhook.log;
    }
    
    # Health check –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    location /health {
        proxy_pass http://127.0.0.1:8080/health;
        access_log off;
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        add_header X-Bot-Status "running" always;
    }
    
    # API endpoint –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    location /api/ {
        proxy_pass http://127.0.0.1:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è API (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        # auth_basic "Bot API";
        # auth_basic_user_file /etc/nginx/.htpasswd;
    }
    
    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –±–æ—Ç–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ)
    location /static/ {
        alias /path/to/seedance/static/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
        
        # –ó–∞—â–∏—Ç–∞ –æ—Ç hotlinking
        valid_referers none blocked bot.seedancebot.com;
        if ($invalid_referer) {
            return 403;
        }
    }
    
    # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–¥–æ–º–µ–Ω–∞ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ
    location / {
        return 200 "ü§ñ Seedance AI Video Bot
        
Telegram Bot: @SeedanceOfficialBot
Webhook: https://bot.seedancebot.com/webhook
Status: https://bot.seedancebot.com/health

Visit main site: https://seedancebot.com
        ";
        add_header Content-Type "text/plain; charset=utf-8";
    }
    
    # –õ–æ–≥–∏ –¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–∞
    access_log /var/log/nginx/bot_seedancebot_access.log;
    error_log /var/log/nginx/bot_seedancebot_error.log;
} 