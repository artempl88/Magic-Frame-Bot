from typing import Dict, Any, Optional
from datetime import datetime

class MessageTemplates:
    """Шаблоны сообщений для бота с улучшенным UX/UI"""
    
    WELCOME = """
🎬 <b>Добро пожаловать в Seedance!</b>

✨ <i>Создавайте магические видео с помощью ИИ</i>

<b>🚀 Ваши возможности:</b>
┌─ 📝 <b>Текст → Видео</b>
│   Превратите идеи в живые сцены
├─ 🖼 <b>Фото → Видео</b>
│   Оживите любое изображение
├─ ⚡ <b>Мгновенная генерация</b>
│   Результат за 30-60 секунд
└─ 🎯 <b>Качество до 1080p</b>
    Профессиональное разрешение

🎁 <b>Подарок новичку:</b> <code>10 бесплатных кредитов</code>

<i>Выберите язык для продолжения ↓</i>
"""
    
    MAIN_MENU = """
🏠 <b>Главная панель</b>

┌─────────────────────────┐
│ 💰 <b>Баланс:</b> {balance} кредитов    │
│ 🎬 <b>Создано:</b> {videos_count} видео      │
└─────────────────────────┘

<i>Что будем создавать сегодня?</i>
"""
    
    GENERATION_START = """
🎨 <b>Студия создания видео</b>

<i>Выберите способ создания вашего шедевра:</i>

┌─ 📝 <b>Текст → Видео</b>
│   <i>Опишите сцену словами</i>
│   • Любые сюжеты и стили
│   • Детальные описания
│   • Творческая свобода
│
└─ 🖼 <b>Изображение → Видео</b>
    <i>Оживите статичную картинку</i>
    • Плавная анимация
    • Сохранение деталей
    • Естественные движения

<i>Нажмите на нужный режим ↓</i>
"""
    
    MODEL_SELECTION = """
🤖 <b>Выбор ИИ-модели</b>

<i>Режим:</i> <b>{mode}</b>

┌─ 🚀 <b>Seedance V1 Lite</b>
│   • Быстрая генерация
│   • Экономичная стоимость
│   • Отличное качество
│
└─ 💎 <b>Seedance V1 Pro</b>
    • Максимальное качество
    • Детализированная обработка
    • Профессиональный результат

<i>Какую модель предпочитаете?</i>
"""
    
    GENERATION_PARAMS = """
⚙️ <b>Настройки генерации</b>

┌─ <b>Конфигурация</b>
├─ 🎯 Режим: <code>{mode}</code>
├─ 🤖 Модель: <code>{model}</code>
├─ 📐 Разрешение: <code>{resolution}</code>
├─ ⏱ Длительность: <code>{duration} сек</code>
├─ 🖼 Формат: <code>{aspect_ratio}</code>
└─ 💰 Стоимость: <b>{cost} кредитов</b>

┌─ <b>Ваш промпт</b>
│ <i>"{prompt}"</i>
└─────────────────────

💳 <b>Баланс:</b> {balance} кредитов
{balance_status}

<i>Всё готово к созданию? ↓</i>
"""
    
    GENERATION_PROGRESS = """
🎬 <b>Создание видео...</b>

{status_emoji} <b>Статус:</b> {status}

┌─ Прогресс
│ {progress_bar}
├─ ⏱ Время: <code>{elapsed_time}</code>
└─ 🔄 В очереди: <code>#{queue_position}</code>

<i>✨ Магия происходит прямо сейчас...</i>
<i>Обычно процесс занимает 30-60 секунд</i>
"""
    
    GENERATION_SUCCESS = """
🎉 <b>Ваше видео готово!</b>

┌─ <b>Информация о файле</b>
├─ 📐 Разрешение: <code>{resolution}</code>
├─ ⏱ Длительность: <code>{duration} сек</code>
├─ 📊 Размер: <code>{file_size} МБ</code>
└─ 🆔 ID: <code>{generation_id}</code>

┌─ <b>Списание</b>
├─ 💰 Потрачено: <code>{cost} кредитов</code>
└─ 💳 Остаток: <code>{balance} кредитов</code>

<i>Оцените результат нашей работы ↓</i>
"""
    
    SHOP_MENU = """
🛒 <b>Магазин кредитов</b>

💰 <b>Текущий баланс:</b> <code>{balance} кредитов</code>

┌─ <b>💡 О кредитах</b>
│ Кредиты — валюта для создания видео
│ <i>1 кредит ≈ 1 секунда видео в 480p</i>
└─────────────────────────────

⭐ <b>Оплата через Telegram Stars</b>
<i>Безопасно • Мгновенно • Удобно</i>

<b>Выберите подходящий пакет:</b>
"""
    
    PACKAGE_DETAILS = """
{emoji} <b>{name}</b> {badge}

┌─ Содержимое пакета
├─ 📦 <b>Кредитов:</b> <code>{credits}</code>
├─ ⭐ <b>Стоимость:</b> <code>{stars} Stars</code>
└─ {discount_text}

<i>💬 {description}</i>

<i>Нажмите "Купить" для оформления ↓</i>
"""
    
    PAYMENT_INVOICE = """
🧾 <b>Счёт на оплату</b>

┌─ Детали заказа
├─ 📦 <b>Пакет:</b> {package_name}
├─ 💰 <b>Кредитов:</b> <code>{credits}</code>
└─ ⭐ <b>К оплате:</b> <code>{stars} Stars</code>

<i>После оплаты кредиты поступят автоматически</i>
"""
    
    PAYMENT_SUCCESS = """
✅ <b>Оплата прошла успешно!</b>

🎉 <b>Поздравляем с покупкой!</b>

┌─ Детали операции
├─ 🎁 <b>Начислено:</b> <code>{credits} кредитов</code>
├─ 💰 <b>Новый баланс:</b> <code>{balance} кредитов</code>
└─ 🧾 <b>Чек:</b> <code>#{transaction_id}</code>

<i>Спасибо за доверие! Создавайте шедевры! 🙏</i>
"""
    
    STATISTICS = """
📊 <b>Ваша статистика</b>

┌─ <b>👤 Профиль</b>
├─ 🆔 ID: <code>{user_id}</code>
├─ 📅 С нами с: <code>{registration_date}</code>
└─ 🌐 Язык: <code>{language}</code>

┌─ <b>💰 Финансы</b>
├─ 💳 Баланс: <code>{balance} кредитов</code>
├─ 📥 Куплено: <code>{total_bought} кредитов</code>
└─ 📤 Потрачено: <code>{total_spent} кредитов</code>

┌─ <b>🎬 Творчество</b>
├─ 📊 Всего видео: <code>{total_generations}</code>
├─ ✅ Успешных: <code>{successful_generations}</code>
├─ ❌ Неудачных: <code>{failed_generations}</code>
└─ ⭐ Средняя оценка: <code>{average_rating}/5</code>

┌─ <b>📈 Активность</b>
├─ 📅 Последнее видео: <code>{last_generation}</code>
└─ 🔥 Дней подряд: <code>{streak_days}</code>

<i>Впечатляющие результаты! 🚀</i>
"""
    
    REFERRAL_PROGRAM = """
👥 <b>Реферальная программа</b>

🎁 <b>Бонусная система:</b>
┌─ Вы получаете: <code>20 кредитов</code>
└─ Ваш друг получает: <code>10 кредитов</code>

┌─ <b>📎 Ваша ссылка</b>
│ <code>{referral_link}</code>
└─ <i>Нажмите для копирования</i>

┌─ <b>📊 Результаты</b>
├─ 👥 Приглашено: <code>{referrals_count} друзей</code>
└─ 💰 Заработано: <code>{earned_credits} кредитов</code>

<i>Делитесь с друзьями и получайте бонусы! 🎉</i>
"""
    
    HISTORY_EMPTY = """
📜 <b>История генераций</b>

┌─────────────────────────┐
│        🎬 Пусто         │
│                         │
│   <i>Здесь будут ваши</i>    │
│   <i>созданные видео</i>     │
└─────────────────────────┘

<i>Нажмите "Создать видео" чтобы начать!</i>
"""
    
    GENERATION_DETAILS = """
🎬 <b>Детали генерации</b>

┌─ <b>Основная информация</b>
├─ 🆔 ID: <code>{id}</code>
├─ 📅 Дата: <code>{date}</code>
└─ ⏱ Статус: {status}

┌─ <b>Параметры</b>
├─ 🎯 Режим: <code>{mode}</code>
├─ 🤖 Модель: <code>{model}</code>
├─ 📐 Разрешение: <code>{resolution}</code>
├─ ⏱ Длительность: <code>{duration} сек</code>
└─ 💰 Стоимость: <code>{cost} кредитов</code>

┌─ <b>Промпт</b>
│ <i>"{prompt}"</i>
└─────────────────────

{additional_info}
"""
    
    ADMIN_STATS = """
📊 <b>Панель администратора</b>

┌─ <b>👥 Пользователи</b>
├─ Всего: <code>{total_users}</code>
├─ Активных (24ч): <code>{active_users}</code>
└─ Новых сегодня: <code>{new_users}</code>

┌─ <b>🎬 Генерации</b>
├─ Всего: <code>{total_generations}</code>
├─ Сегодня: <code>{today_generations}</code>
└─ В обработке: <code>{pending_generations}</code>

┌─ <b>💰 Финансы</b>
├─ Продано кредитов: <code>{credits_sold}</code>
├─ Заработано Stars: <code>{stars_earned}</code>
└─ Средний чек: <code>{avg_purchase}</code>

┌─ <b>🔧 Система</b>
├─ Uptime: <code>{uptime}</code>
├─ CPU: <code>{cpu_usage}%</code>
├─ RAM: <code>{ram_usage}%</code>
└─ Очередь: <code>{queue_size}</code>
"""
    
    BROADCAST_CONFIRM = """
📢 <b>Подтверждение рассылки</b>

┌─ <b>Параметры рассылки</b>
├─ 📊 Получателей: <code>{recipients_count}</code>
└─ 📝 Предварительный просмотр:

{message_preview}

<i>Начать массовую рассылку?</i>
"""
    
    SUPPORT_WELCOME = """
💬 <b>Служба поддержки</b>

┌─────────────────────────┐
│    <i>Мы всегда готовы</i>    │
│       <i>помочь вам!</i>      │
└─────────────────────────┘

<b>Выберите тип обращения:</b>
"""
    
    SUPPORT_NEW_TICKET = """
✍️ <b>Новое обращение</b>

<i>Опишите вашу проблему или вопрос максимально подробно.</i>

┌─ <b>💡 Советы для быстрого решения:</b>
├─ Укажите ID проблемной генерации
├─ Приложите скриншоты при необходимости
└─ Опишите шаги для воспроизведения

<i>⏰ Мы ответим в течение 24 часов</i>
"""
    
    SETTINGS_MENU = """
⚙️ <b>Настройки профиля</b>

<i>Персонализируйте работу бота под себя</i>

┌─ <b>Доступные настройки:</b>
├─ 🌐 Язык интерфейса
├─ 🔔 Уведомления
├─ 🎨 Параметры по умолчанию
└─ 📊 Приватность данных

<i>Выберите нужный раздел ↓</i>
"""
    
    BALANCE_INFO = """
💰 <b>Детализация баланса</b>

💳 <b>Текущий баланс:</b> <code>{balance} кредитов</code>

┌─ <b>📊 История операций</b>
├─ 📥 Пополнено: <code>{total_bought} кредитов</code>
├─ 📤 Потрачено: <code>{total_spent} кредитов</code>
└─ 🎁 Бонусов: <code>{bonuses} кредитов</code>

┌─ <b>💡 Способы получения кредитов</b>
├─ 🛒 Покупка в магазине
├─ 🎉 Участие в акциях
└─ 🎁 Промокоды и бонусы

<i>Выберите подходящий способ пополнения!</i>
"""
    
    ERROR_INSUFFICIENT_BALANCE = """
❌ <b>Недостаточно средств</b>

┌─ <b>Детали операции</b>
├─ 💰 Ваш баланс: <code>{balance} кредитов</code>
├─ 💎 Требуется: <code>{required} кредитов</code>
└─ 📊 Не хватает: <code>{missing} кредитов</code>

<i>Пополните баланс для продолжения работы</i>
"""
    
    ERROR_GENERATION_FAILED = """
❌ <b>Ошибка генерации</b>

<i>К сожалению, произошла техническая ошибка</i>

┌─ <b>Что мы сделали:</b>
├─ 💰 Кредиты возвращены на баланс
├─ 📝 Ошибка зафиксирована: <code>{error_code}</code>
└─ 🔧 Уведомили техническую поддержку

<i>Попробуйте ещё раз или обратитесь в поддержку</i>
"""
    
    PROMO_CODE_ACTIVATED = """
🎉 <b>Промокод активирован!</b>

┌─ <b>Поздравляем!</b>
├─ 🎁 Бонус: <code>{bonus}</code>
└─ 💰 Новый баланс: <code>{balance} кредитов</code>

<i>Спасибо за использование промокода! 🙏</i>
"""
    
    FAQ = """
❓ <b>Частые вопросы</b>

<b>🔹 Что такое кредиты?</b>
<i>Кредиты — внутренняя валюта для оплаты генераций. 
1 кредит ≈ 1 секунда видео в базовом качестве.</i>

<b>🔹 Как купить кредиты?</b>
<i>Нажмите "Купить кредиты" в главном меню и выберите пакет. 
Оплата через Telegram Stars.</i>

<b>🔹 Сколько времени занимает генерация?</b>
<i>Обычно 30-60 секунд, в зависимости от параметров 
и текущей загруженности системы.</i>

<b>🔹 Какие форматы изображений поддерживаются?</b>
<i>JPEG и PNG до 10 МБ, минимальное разрешение 300x300 px.</i>

<b>🔹 Можно ли отменить генерацию?</b>
<i>Нет, после подтверждения генерация не может быть отменена.</i>

<b>🔹 Почему видео не генерируется?</b>
<i>Проверьте баланс, корректность параметров 
и попробуйте упростить промпт.</i>

<b>❓ Остались вопросы?</b>
<i>Напишите в службу поддержки!</i>
"""
    
    @staticmethod
    def create_progress_bar(percentage: int) -> str:
        """Создание красивого прогресс-бара"""
        filled = int(percentage / 10)
        bar = '█' * filled + '░' * (10 - filled)
        return f"│ {bar} {percentage}%"
    
    @staticmethod
    def format_time(seconds: int) -> str:
        """Форматирование времени"""
        if seconds < 60:
            return f"{seconds} сек"
        minutes = seconds // 60
        seconds = seconds % 60
        return f"{minutes} мин {seconds} сек"
    
    @staticmethod
    def format_date(date: datetime) -> str:
        """Форматирование даты"""
        now = datetime.utcnow()
        diff = now - date
        
        if diff.days == 0:
            if diff.seconds < 3600:
                return f"{diff.seconds // 60} мин назад"
            else:
                return f"{diff.seconds // 3600} ч назад"
        elif diff.days == 1:
            return "вчера"
        elif diff.days < 7:
            return f"{diff.days} дн назад"
        else:
            return date.strftime("%d.%m.%Y")
    
    @staticmethod
    def format_credits(amount: int) -> str:
        """Форматирование количества кредитов"""
        if amount >= 1000000:
            return f"{amount // 1000000}M"
        elif amount >= 1000:
            return f"{amount // 1000}K"
        return str(amount)
    
    @staticmethod
    def get_status_text(status: str) -> str:
        """Получить красивый текст статуса"""
        statuses = {
            "pending": "⏳ <i>В очереди</i>",
            "processing": "🔄 <i>Обработка</i>",
            "completed": "✅ <i>Завершено</i>",
            "failed": "❌ <i>Ошибка</i>",
            "cancelled": "🚫 <i>Отменено</i>"
        }
        return statuses.get(status, f"<i>{status}</i>")
    
    @staticmethod
    def get_mode_text(mode: str) -> str:
        """Получить красивый текст режима"""
        modes = {
            "t2v": "📝 Текст → Видео",
            "i2v": "🖼 Изображение → Видео"
        }
        return modes.get(mode, mode)
