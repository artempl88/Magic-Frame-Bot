# –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è

–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤.

## üéØ –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ

- **Telegram Bot** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
- **PostgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –∫–µ—à –∏ —Å–µ—Å—Å–∏–∏
- **Celery Worker** - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î

## üö´ –ß—Ç–æ —É–±—Ä–∞–Ω–æ

- Nginx (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- Prometheus/Grafana (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- Flower (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery)
- Celery Beat (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏)

## üì¶ –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| Bot webhook | 8081 | HTTP endpoint –¥–ª—è Telegram |
| PostgreSQL | 5433 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø) |
| Redis | 6380 | –ö–µ—à (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø) |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.client`:

```bash
# Telegram Bot
BOT_TOKEN=1234567890:AAAA-BBBB_CCCC_DDDD_EEEE_FFFF_GGGG_HHHH
BOT_USERNAME=YourClientBot

# API
WAVESPEED_API_KEY=your_api_key_here

# Database
DB_PASSWORD=secure_db_password_123

# Redis
REDIS_PASSWORD=secure_redis_password_123

# Admin
ADMIN_IDS=123456789,987654321

# Webhook
WEBHOOK_HOST=https://your-domain.com
```

### 2. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
make -f Makefile.client quick-start

# –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
make -f Makefile.client start-minimal

# –° Celery Worker
make -f Makefile.client up-full
```

### 3. –ó–∞–ø—É—Å–∫ –Ω–∞ VPS

```bash
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
make -f Makefile.client vps-up

# –° Celery Worker
make -f Makefile.client vps-up-full

# –° —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º
make -f Makefile.client vps-up-backup
```

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
make -f Makefile.client help

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
make -f Makefile.client status

# –õ–æ–≥–∏
make -f Makefile.client logs
make -f Makefile.client logs-bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
make -f Makefile.client restart

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
make -f Makefile.client down
```

### –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
make -f Makefile.client shell-db

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make -f Makefile.client migrate

# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
make -f Makefile.client backup

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
make -f Makefile.client restore-file BACKUP_FILE=./backups/backup_20240101_120000.sql.gz
```

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–æ–≤
make -f Makefile.client health

# Debug —Ä–µ–∂–∏–º
make -f Makefile.client debug

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞ Python
make -f Makefile.client debug-shell
```

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

### Nginx

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `/etc/nginx/sites-available/client-bot`:

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### Caddy

–°–æ–∑–¥–∞–π—Ç–µ `Caddyfile`:

```
your-domain.com {
    reverse_proxy localhost:8081
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
make -f Makefile.client stats

# –ü—Ä–æ—Ü–µ—Å—Å—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
make -f Makefile.client top

# Health check
curl http://localhost:8081/health
```

### –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
docker system df

# –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
journalctl -u docker -f
```

## üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –±—ç–∫–∞–ø–∞–º–∏
make -f Makefile.client up-backup

# –ù–∞ VPS —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –±—ç–∫–∞–ø–∞–º–∏
make -f Makefile.client vps-up-backup
```

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤:**
- üïí **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00 UTC** - –æ—Å–Ω–æ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã
- üïë **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 2:00 UTC** - –ø–æ–ª–Ω—ã–µ –±—ç–∫–∞–ø—ã (—Ç–æ–ª—å–∫–æ VPS)
- üßπ **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 4:00 UTC** - –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π

### –†—É—á–Ω—ã–µ –±—ç–∫–∞–ø—ã

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
make -f Makefile.client backup-auto

# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É –±–æ—Ç–∞ (—Å –æ–ø–∏—Å–∞–Ω–∏–µ–º)
# /admin ‚Üí üíæ –ë—ç–∫–∞–ø—ã –ë–î ‚Üí ‚ûï –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤
make -f Makefile.client backup-list

# –†–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏ —Å –±—ç–∫–∞–ø–∞–º–∏
make -f Makefile.client backup-size

# –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã
make -f Makefile.client backup-cleanup

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞
make -f Makefile.client restore-file BACKUP_FILE=./backups/backup_20240101_120000.sql.gz
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É

–í –∞–¥–º–∏–Ω—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏ –±–æ—Ç–∞ (`/admin` ‚Üí `üíæ –ë—ç–∫–∞–ø—ã –ë–î`) –¥–æ—Å—Ç—É–ø–Ω–æ:

- **‚ûï –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø** - —Ä—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
- **üìÅ –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤** - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏  
- **üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—ç–∫–∞–ø–∞—Ö
- **üßπ –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ** - —É–¥–∞–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
- **üóëÔ∏è –£–¥–∞–ª–∏—Ç—å** - —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
- **‚ö†Ô∏è –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
‚îú‚îÄ‚îÄ .env.client              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.simple.yml # –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ‚îÄ docker-compose.client.yml # VPS —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ Makefile.client          # –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ logs/                    # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ static/                  # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ backups/                 # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
```

### –ü—Ä–æ—Ñ–∏–ª–∏ Docker Compose

- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –¢–æ–ª—å–∫–æ bot + postgres + redis
- **full**: –î–æ–±–∞–≤–ª—è–µ—Ç Celery Worker
- **backup**: –î–æ–±–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

```bash
# –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
docker-compose -f docker-compose.client.yml --profile full up -d
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤

–ï—Å–ª–∏ –ø–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã, –∏–∑–º–µ–Ω–∏—Ç–µ –∏—Ö –≤ —Ñ–∞–π–ª–∞—Ö:
- `docker-compose.simple.yml` - –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `docker-compose.client.yml` - –¥–ª—è VPS

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
make -f Makefile.client shell-db

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î
make -f Makefile.client clean
make -f Makefile.client up
make -f Makefile.client migrate
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é

–£–º–µ–Ω—å—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis –≤ docker-compose —Ñ–∞–π–ª–∞—Ö:

```yaml
redis:
  command: >
    redis-server
    --maxmemory 128mb  # –±—ã–ª–æ 256mb
```

### –õ–æ–≥–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç –¥–∏—Å–∫

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ Docker
docker system prune -a -f

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤
echo '{"log-driver":"json-file","log-opts":{"max-size":"10m","max-file":"3"}}' | sudo tee /etc/docker/daemon.json
sudo systemctl restart docker
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–£–≤–µ–ª–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å –¥–ª—è Redis**:
```yaml
--maxmemory 512mb
```

2. **–î–æ–±–∞–≤–∏—Ç—å Celery Worker**:
```bash
make -f Makefile.client up-full
```

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**:
```yaml
command: celery -A bot.tasks worker --concurrency=4
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker stats

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
df -h
du -sh ./logs ./backups

# –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É
htop
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏** –≤ `.env.client`
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º** —á–µ—Ä–µ–∑ firewall
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** Docker –æ–±—Ä–∞–∑—ã
4. **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
docker-compose pull
make -f Makefile.client restart
``` 